(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     82906,       2097]
NotebookOptionsPosition[     76029,       1967]
NotebookOutlinePosition[     76371,       1982]
CellTagsIndexPosition[     76328,       1979]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Clear Workspace", "Subsection",
 CellChangeTimes->{{3.465644519984375*^9, 3.465644520671875*^9}, {
  3.5824075291179495`*^9, 
  3.5824075314267535`*^9}},ExpressionUUID->"1be9c85a-f53d-40f0-aeea-\
c806872843dc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Remove", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.4628993695007*^9, 3.4628993711507*^9}, {
  3.4628995236937*^9, 3.4628995417777*^9}, {3.4629012084867*^9, 
  3.4629012144207*^9}, {3.4629012669617*^9, 3.4629012747977*^9}, {
  3.4629013846857*^9, 3.4629013853077*^9}, {3.4741254201057*^9, 
  3.4741254219427*^9}, {3.6286038941019564`*^9, 
  3.628603894301956*^9}},ExpressionUUID->"e0e16345-cb68-43c8-b05e-\
6562dabbce46"]
}, Open  ]],

Cell[CellGroupData[{

Cell["System", "Subsection",
 CellChangeTimes->{{3.632763129680771*^9, 
  3.6327631374517813`*^9}},ExpressionUUID->"c0eaa71c-8ffd-4a14-884a-\
388a0cd1440e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"f", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{"\[Beta]", "*", 
     SuperscriptBox[
      RowBox[{"Exp", "[", "z", "]"}], 
      FractionBox["1", 
       RowBox[{"\[Alpha]", "-", "1"}]]], "*", 
     FractionBox[
      RowBox[{"Exp", "[", "c", "]"}], 
      RowBox[{"Exp", "[", "cp", "]"}]], "*", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"\[Alpha]", "*", 
        RowBox[{"Exp", "[", "zp", "]"}], "*", 
        SuperscriptBox[
         RowBox[{"Exp", "[", "k", "]"}], 
         RowBox[{"\[Alpha]", "-", "1"}]]}], "+", "1", "-", "\[Delta]"}], 
      ")"}]}], "-", "1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"[", "2", "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Exp", "[", "z", "]"}], "*", 
     SuperscriptBox[
      RowBox[{"Exp", "[", "klag", "]"}], "\[Alpha]"]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "\[Delta]"}], ")"}], "*", 
     RowBox[{"Exp", "[", "klag", "]"}]}], "-", 
    RowBox[{"Exp", "[", "c", "]"}], "-", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Exp", "[", "z", "]"}], 
      FractionBox["1", 
       RowBox[{"1", "-", "\[Alpha]"}]]], "*", 
     RowBox[{"Exp", "[", "k", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"[", "3", "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{"\[Mu]", "[", "s", "]"}], "+", 
    RowBox[{
     RowBox[{"\[Sigma]", "[", "s", "]"}], "*", "\[Epsilon]"}], "-", "z"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"[", "4", "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{"Log", "[", 
     FractionBox[
      RowBox[{
       FractionBox["1", 
        RowBox[{"\[Sigma]", "[", "1", "]"}]], 
       RowBox[{"\[Phi]", "[", 
        FractionBox[
         RowBox[{"z", "-", 
          RowBox[{"\[Mu]", "[", "1", "]"}]}], 
         RowBox[{"\[Sigma]", "[", "1", "]"}]], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"1", ",", "1"}], "]"}], "*", 
          FractionBox["1", 
           RowBox[{"1", "+", 
            RowBox[{"Exp", "[", 
             RowBox[{"-", "\[Eta]1lag"}], "]"}]}]]}], "+", 
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"2", ",", "1"}], "]"}], 
          RowBox[{"(", 
           FractionBox["1", 
            RowBox[{"1", "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"-", "\[Eta]2lag"}], "]"}]}]], ")"}]}]}], ")"}]}], 
      RowBox[{
       FractionBox["1", 
        RowBox[{"\[Sigma]", "[", "2", "]"}]], 
       RowBox[{"\[Phi]", "[", 
        FractionBox[
         RowBox[{"z", "-", 
          RowBox[{"\[Mu]", "[", "2", "]"}]}], 
         RowBox[{"\[Sigma]", "[", "2", "]"}]], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"1", ",", "2"}], "]"}], "*", 
          FractionBox["1", 
           RowBox[{"1", "+", 
            RowBox[{"Exp", "[", 
             RowBox[{"-", "\[Eta]1lag"}], "]"}]}]]}], "+", 
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"2", ",", "2"}], "]"}], 
          RowBox[{"(", 
           FractionBox["1", 
            RowBox[{"1", "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"-", "\[Eta]2lag"}], "]"}]}]], ")"}]}]}], ")"}]}]], 
     "]"}], "-", "\[Eta]1"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"[", "5", "]"}], "]"}], "=", 
   RowBox[{
    RowBox[{"Log", "[", 
     FractionBox[
      RowBox[{
       FractionBox["1", 
        RowBox[{"\[Sigma]", "[", "2", "]"}]], 
       RowBox[{"\[Phi]", "[", 
        FractionBox[
         RowBox[{"z", "-", 
          RowBox[{"\[Mu]", "[", "2", "]"}]}], 
         RowBox[{"\[Sigma]", "[", "2", "]"}]], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"1", ",", "2"}], "]"}], "*", 
          FractionBox["1", 
           RowBox[{"1", "+", 
            RowBox[{"Exp", "[", 
             RowBox[{"-", "\[Eta]1lag"}], "]"}]}]]}], "+", 
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"2", ",", "2"}], "]"}], 
          RowBox[{"(", 
           FractionBox["1", 
            RowBox[{"1", "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"-", "\[Eta]2lag"}], "]"}]}]], ")"}]}]}], ")"}]}], 
      RowBox[{
       FractionBox["1", 
        RowBox[{"\[Sigma]", "[", "1", "]"}]], 
       RowBox[{"\[Phi]", "[", 
        FractionBox[
         RowBox[{"z", "-", 
          RowBox[{"\[Mu]", "[", "1", "]"}]}], 
         RowBox[{"\[Sigma]", "[", "1", "]"}]], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"1", ",", "1"}], "]"}], "*", 
          FractionBox["1", 
           RowBox[{"1", "+", 
            RowBox[{"Exp", "[", 
             RowBox[{"-", "\[Eta]1lag"}], "]"}]}]]}], "+", 
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"2", ",", "1"}], "]"}], 
          RowBox[{"(", 
           FractionBox["1", 
            RowBox[{"1", "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"-", "\[Eta]2lag"}], "]"}]}]], ")"}]}]}], ")"}]}]], 
     "]"}], "-", "\[Eta]2"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Phi]", "[", "x_", "]"}], "=", 
   RowBox[{"PDF", "[", 
    RowBox[{
     RowBox[{"NormalDistribution", "[", "]"}], ",", "x"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"f", "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.632763139911785*^9, 3.632763409024165*^9}, {
   3.6327634402962093`*^9, 3.6327634419062114`*^9}, {3.6327664440591516`*^9, 
   3.632766444839153*^9}, {3.6327676791798964`*^9, 3.632767681219899*^9}, {
   3.6327677574030113`*^9, 3.6327677804430475`*^9}, {3.6327726542625003`*^9, 
   3.632772658667569*^9}, {3.6328297185501204`*^9, 3.6328297708812294`*^9}, {
   3.633298914164136*^9, 3.6332991251433735`*^9}, 3.6332992427930613`*^9, {
   3.633299334765042*^9, 3.6332993427150974`*^9}, {3.633299524691136*^9, 
   3.633299524756137*^9}, {3.6333504878910327`*^9, 3.6333507116743574`*^9}, {
   3.6339590973043876`*^9, 3.6339591617995176`*^9}, {3.6339600287766294`*^9, 
   3.633960029624631*^9}, {3.6340449218840046`*^9, 3.634044975794088*^9}, 
   3.6340467492274623`*^9, {3.634047259915187*^9, 3.6340472623751907`*^9}, {
   3.6340478147529707`*^9, 3.6340478156129713`*^9}, {3.634065576392748*^9, 
   3.6340658078312664`*^9}, {3.634065873161428*^9, 3.634065917988549*^9}, {
   3.634065979922675*^9, 3.634065997300711*^9}, {3.6340661837912064`*^9, 
   3.634066187480215*^9}, {3.6340662887755013`*^9, 3.634066288942502*^9}, 
   3.634066349902624*^9, {3.6340663840697594`*^9, 3.6340663885097704`*^9}, {
   3.6340665172240715`*^9, 3.6340665195640755`*^9}, {3.634306403228092*^9, 
   3.6343064261234016`*^9}, {3.634309163417501*^9, 3.6343091662576637`*^9}, {
   3.6343092358272495`*^9, 3.6343092369472513`*^9}, {3.634319383146976*^9, 
   3.634319384446978*^9}, {3.6343231397180777`*^9, 3.6343231406991343`*^9}, {
   3.640455574820058*^9, 3.640455605258133*^9}, {3.640456537782775*^9, 
   3.6404565586318045`*^9}, 3.640456625640938*^9, {3.642975732947666*^9, 
   3.642975734737669*^9}, 3.6455435633977995`*^9, 3.645543665331064*^9, {
   3.671295391147991*^9, 3.6712953916979923`*^9}, {3.6712954952684317`*^9, 
   3.6712955216025686`*^9}, {3.700499411910726*^9, 3.7004994886791167`*^9}, {
   3.700500034119314*^9, 3.7005000789278774`*^9}, {3.7005912797480097`*^9, 
   3.7005912830906754`*^9}, {3.7005913236616173`*^9, 
   3.7005913651984634`*^9}, {3.7183878103019986`*^9, 3.718387830077116*^9}, {
   3.7187076830992537`*^9, 3.7187077220062356`*^9}, 3.7239143108732133`*^9, {
   3.7240080128812437`*^9, 3.724008019568671*^9}, {3.7240080523811164`*^9, 
   3.72400805781507*^9}, {3.72400822435079*^9, 3.7240082251981044`*^9}, {
   3.724008275586396*^9, 3.724008276431641*^9}, {3.7240197055907526`*^9, 
   3.7240197184291945`*^9}},ExpressionUUID->"90bfea0d-31c9-476c-b354-\
3c7d9feb47db"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Variables Definitions", "Subsection",
 CellChangeTimes->{{3.5359999768587947`*^9, 3.5359999836951857`*^9}, {
   3.5764996882111*^9, 3.576499694551109*^9}, 
   3.5765000569766483`*^9},ExpressionUUID->"584da757-11cc-4966-97b3-\
11b44b90c8e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Non", "-", 
    RowBox[{"Predetermined", " ", "Variables"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"yvarsp", "=", 
     RowBox[{"{", 
      RowBox[{"cp", ",", "zp"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yvars", "=", 
     RowBox[{"{", 
      RowBox[{"c", ",", "z"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yfuns", "=", 
     RowBox[{"{", 
      RowBox[{"cfun", ",", "zfun"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yvarss", "=", 
     RowBox[{"{", 
      RowBox[{"css", ",", "zss"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yvarssval", "=", 
     RowBox[{"{", 
      RowBox[{"cssval", ",", "zssval"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Predetermined", " ", "Variables"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xvars", "=", 
     RowBox[{"{", 
      RowBox[{"k", ",", "\[Eta]1", ",", "\[Eta]2"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xlag", "=", 
     RowBox[{"{", 
      RowBox[{"klag", ",", "\[Eta]1lag", ",", "\[Eta]2lag"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xfuns", "=", 
     RowBox[{"{", 
      RowBox[{"kfun", ",", "\[Eta]1fun", ",", "\[Eta]2fun"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xvarss", "=", 
     RowBox[{"{", 
      RowBox[{"kss", ",", "\[Eta]1ss", ",", "\[Eta]2ss"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xvarssval", "=", 
     RowBox[{"{", 
      RowBox[{"kssval", ",", "\[Eta]1ssval", ",", "\[Eta]2ssval"}], "}"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "Shocks", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"epsp", "=", 
     RowBox[{"{", "\[Epsilon]p", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"eps", "=", 
     RowBox[{"{", "\[Epsilon]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Markov", " ", "Switching", " ", "Variables"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tvarsp", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Mu]", "[", "sp", "]"}], ",", 
       RowBox[{"\[Sigma]", "[", "sp", "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tvars", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Mu]", "[", "s", "]"}], ",", 
       RowBox[{"\[Sigma]", "[", "s", "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tvarspss", "=", 
     RowBox[{"{", 
      RowBox[{"\[Mu]bar", ",", "\[Sigma]bar"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tvarss", "=", 
     RowBox[{"{", 
      RowBox[{"\[Mu]bar", ",", "\[Sigma]bar"}], "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.576499891656398*^9, 3.576500003176573*^9}, 
   3.5765000569766483`*^9, 3.5765010194101195`*^9, {3.5765046809617567`*^9, 
   3.576504682121758*^9}, {3.576505456151792*^9, 3.576505486654341*^9}, {
   3.576505553684455*^9, 3.5765055765644875`*^9}, {3.577038045760437*^9, 
   3.57703804827044*^9}, {3.577038139390568*^9, 3.5770381398805685`*^9}, {
   3.5770381817031283`*^9, 3.57703820063067*^9}, {3.5771221501422386`*^9, 
   3.577122169992266*^9}, {3.5934379905838156`*^9, 3.5934380846441956`*^9}, {
   3.5934381294377575`*^9, 3.5934381663738704`*^9}, {3.6040805687078896`*^9, 
   3.6040805691239133`*^9}, {3.604080613979479*^9, 3.604080683947481*^9}, {
   3.6077044932731476`*^9, 3.6077044972333746`*^9}, {3.607704544801095*^9, 
   3.6077045458971577`*^9}, {3.60770462461666*^9, 3.607704626976795*^9}, {
   3.607704661953796*^9, 3.6077046936876106`*^9}, {3.607705056756377*^9, 
   3.6077050638777847`*^9}, {3.6077211525189705`*^9, 3.607721174510228*^9}, {
   3.607773489859482*^9, 3.6077735036432705`*^9}, 3.607773585332943*^9, {
   3.6077752027444534`*^9, 3.607775260806774*^9}, {3.6077766029545407`*^9, 
   3.607776607186783*^9}, {3.6077767651778193`*^9, 3.6077767967856274`*^9}, {
   3.6077768444493537`*^9, 3.6077768681207075`*^9}, {3.60777731592632*^9, 
   3.6077773416457915`*^9}, {3.6077776089160786`*^9, 3.6077776591159496`*^9}, 
   3.6077776926988707`*^9, {3.60777846266191*^9, 3.607778470741372*^9}, {
   3.607778508101509*^9, 3.607778509309578*^9}, {3.607778565733805*^9, 
   3.6077785774854774`*^9}, {3.6077867237944193`*^9, 3.607786726401569*^9}, {
   3.6077871008079834`*^9, 3.6077871086954346`*^9}, {3.6078067908649845`*^9, 
   3.6078068103671*^9}, {3.6084116395280347`*^9, 3.608411686778101*^9}, {
   3.608413510674198*^9, 3.608413516719544*^9}, {3.608413589000678*^9, 
   3.6084135893646994`*^9}, {3.6084866794383907`*^9, 
   3.6084866998865595`*^9}, {3.608486776685952*^9, 3.6084867866375217`*^9}, {
   3.6084868564995174`*^9, 3.6084869000850105`*^9}, {3.608486996812543*^9, 
   3.6084870065881023`*^9}, {3.6084870431911955`*^9, 3.608487046492385*^9}, {
   3.608554394570922*^9, 3.6085544121769295`*^9}, {3.6085551476439953`*^9, 
   3.608555156026475*^9}, {3.608555322769012*^9, 3.608555326337216*^9}, {
   3.6088357607233095`*^9, 3.6088357801484203`*^9}, {3.6088359220185347`*^9, 
   3.6088359427877226`*^9}, {3.6088364081131315`*^9, 
   3.6088364387798853`*^9}, {3.6088982053791666`*^9, 
   3.6088982132356167`*^9}, {3.6088982657796216`*^9, 3.608898282555581*^9}, {
   3.6089968428728323`*^9, 3.608996862840975*^9}, {3.609007700201022*^9, 
   3.609007719624133*^9}, {3.609601719826563*^9, 3.609601834106099*^9}, {
   3.609601890882346*^9, 3.609601896784684*^9}, {3.6096019967584023`*^9, 
   3.609601998277489*^9}, {3.6096020708296385`*^9, 3.6096020870315657`*^9}, {
   3.609676892482709*^9, 3.6096769198427477`*^9}, {3.6096787703621616`*^9, 
   3.6096788251692953`*^9}, {3.609678950221447*^9, 3.6096789547647066`*^9}, {
   3.6100272677384396`*^9, 3.6100272677384396`*^9}, {3.610027357498565*^9, 
   3.610027357508565*^9}, {3.6265493239258213`*^9, 3.6265493239768214`*^9}, {
   3.6265493559178886`*^9, 3.6265493559578886`*^9}, {3.626550403339673*^9, 
   3.626550403369673*^9}, {3.626550520301965*^9, 3.6265505203719654`*^9}, {
   3.6265510135511875`*^9, 3.626551013661187*^9}, {3.6265518651792955`*^9, 
   3.626551866711298*^9}, {3.6339591815775614`*^9, 3.6339592591247764`*^9}, {
   3.633960032430638*^9, 3.6339600369606466`*^9}, {3.6340449906499376`*^9, 
   3.634045008976986*^9}, {3.6340451159521046`*^9, 3.6340451677920694`*^9}, {
   3.6340452341998672`*^9, 3.6340452374720545`*^9}, {3.634047391955373*^9, 
   3.634047395027377*^9}, 3.6340474331524305`*^9, {3.6340474862235055`*^9, 
   3.6340475160955486`*^9}, {3.634047876002057*^9, 3.6340478886820745`*^9}, {
   3.6340658206513195`*^9, 3.634065862635404*^9}, {3.634311941324374*^9, 
   3.63431194911582*^9}, {3.6404556078281403`*^9, 3.6404556662313085`*^9}, {
   3.6404577687349195`*^9, 3.64045776899492*^9}, {3.6429757451676836`*^9, 
   3.6429757773677287`*^9}, {3.6455435763378177`*^9, 
   3.6455435874178343`*^9}, {3.7004994674869046`*^9, 3.700499484839897*^9}, {
   3.7004999921189117`*^9, 3.7005000087908654`*^9}, {3.7005912927367105`*^9, 
   3.7005913179491887`*^9}, 
   3.718041565776557*^9},ExpressionUUID->"2884a3d1-1e63-456b-bb7b-\
0d7ea48d8704"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Subsection",
 CellChangeTimes->{{3.549388834060892*^9, 
  3.5493888351169524`*^9}},ExpressionUUID->"a9d3ee2b-243b-45d1-bf5c-\
0ecc9423963e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Define", " ", "States"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"state", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"xlag", ",", "eps", ",", "\[Chi]"}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"statep", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"xvars", ",", 
        RowBox[{"\[Chi]", "*", "epsp"}], ",", "\[Chi]"}], "}"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Function", " ", "Lists"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yfunlist", "=", 
     RowBox[{"Through", "[", 
      RowBox[{"Apply", "[", 
       RowBox[{
        RowBox[{"Through", "[", 
         RowBox[{"Apply", "[", 
          RowBox[{"yfuns", ",", 
           RowBox[{"{", "_", "}"}]}], "]"}], "]"}], ",", 
        RowBox[{"{", "__", "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xfunlist", "=", 
     RowBox[{"Through", "[", 
      RowBox[{"Apply", "[", 
       RowBox[{
        RowBox[{"Through", "[", 
         RowBox[{"Apply", "[", 
          RowBox[{"xfuns", ",", 
           RowBox[{"{", "_", "}"}]}], "]"}], "]"}], ",", 
        RowBox[{"{", "__", "}"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Define", " ", "Functions"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"funrulei", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"yvars", "\[Rule]", 
          RowBox[{"Through", "[", 
           RowBox[{"Apply", "[", 
            RowBox[{
             RowBox[{"Through", "[", 
              RowBox[{"Apply", "[", 
               RowBox[{"yfuns", ",", 
                RowBox[{"{", "s", "}"}]}], "]"}], "]"}], ",", "state"}], 
            "]"}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"xvars", "\[Rule]", 
          RowBox[{"Through", "[", 
           RowBox[{"Apply", "[", 
            RowBox[{
             RowBox[{"Through", "[", 
              RowBox[{"Apply", "[", 
               RowBox[{"xfuns", ",", 
                RowBox[{"{", "s", "}"}]}], "]"}], "]"}], ",", "state"}], 
            "]"}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"tvars", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{"tvarss", "+", 
            RowBox[{"\[Chi]", "*", 
             RowBox[{"(", 
              RowBox[{"tvars", "-", "tvarss"}], ")"}]}]}], ")"}]}], "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"tvars", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"tvarss", "+", 
             RowBox[{"\[Chi]", "*", 
              RowBox[{"(", 
               RowBox[{"tvars", "-", "tvarss"}], ")"}]}]}], ")"}]}], "]"}], "/.", 
         RowBox[{"s", "\[Rule]", "1"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"tvars", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"tvarss", "+", 
             RowBox[{"\[Chi]", "*", 
              RowBox[{"(", 
               RowBox[{"tvars", "-", "tvarss"}], ")"}]}]}], ")"}]}], "]"}], "/.", 
         RowBox[{"s", "\[Rule]", "2"}]}]}], "\[IndentingNewLine]", "}"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"funrulej", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"yvarsp", "\[Rule]", 
          RowBox[{"Through", "[", 
           RowBox[{"Apply", "[", 
            RowBox[{
             RowBox[{"Through", "[", 
              RowBox[{"Apply", "[", 
               RowBox[{"yfuns", ",", 
                RowBox[{"{", "sp", "}"}]}], "]"}], "]"}], ",", "statep"}], 
            "]"}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Thread", "[", 
         RowBox[{"tvarsp", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{"tvarspss", "+", 
            RowBox[{"\[Chi]", "*", 
             RowBox[{"(", 
              RowBox[{"tvarsp", "-", "tvarspss"}], ")"}]}]}], ")"}]}], 
         "]"}]}], "\[IndentingNewLine]", "}"}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.6084090394914484`*^9, 3.6084090522741795`*^9}, {
   3.608410282801562*^9, 3.608410289635953*^9}, {3.608410332476403*^9, 
   3.6084103480282927`*^9}, {3.6084104946836805`*^9, 
   3.6084105195771046`*^9}, {3.6084108166840982`*^9, 
   3.6084108292958193`*^9}, {3.608410974673135*^9, 3.6084110247079964`*^9}, 
   3.6084110789821005`*^9, {3.608411244063543*^9, 3.6084112820497155`*^9}, {
   3.6084116574180593`*^9, 3.6084117409481764`*^9}, 3.6084134930631914`*^9, {
   3.6084136175463114`*^9, 3.608413646495967*^9}, {3.608413823115069*^9, 
   3.608413876134102*^9}, {3.6084144921143336`*^9, 3.60841449536652*^9}, {
   3.6084153345345173`*^9, 3.6084153437640452`*^9}, {3.6096770800670266`*^9, 
   3.609677081567029*^9}, {3.6339592950638523`*^9, 3.633959368153034*^9}, {
   3.634045175914534*^9, 3.6340452182649565`*^9}, {3.6340452771203227`*^9, 
   3.6340452788804235`*^9}, {3.63404533056738*^9, 3.634045374904916*^9}, {
   3.6340454094888935`*^9, 3.634045436432435*^9}, {3.6340457465991755`*^9, 
   3.6340457665323153`*^9}, {3.6340473156972656`*^9, 
   3.6340473362242947`*^9}, {3.6340660774989243`*^9, 3.634066080993932*^9}, {
   3.6340672659277225`*^9, 3.6340672663577228`*^9}, {3.6343115988938556`*^9, 
   3.6343116079718685`*^9}, {3.6343119521579933`*^9, 3.634311976853406*^9}, {
   3.634326305411641*^9, 3.6343263160616617`*^9}, {3.7004995236391163`*^9, 
   3.70049952405514*^9}},ExpressionUUID->"ea689857-324d-4727-a4d2-\
2326547345e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ns", "=", "2"}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"Number", " ", "of", " ", "regimes"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ny", "=", 
   RowBox[{
    RowBox[{"Dimensions", "[", "yvars", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nx", "=", 
   RowBox[{
    RowBox[{"Dimensions", "[", "xvars", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ne", "=", 
   RowBox[{
    RowBox[{"Dimensions", "[", "eps", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nt", "=", 
    RowBox[{
     RowBox[{"Dimensions", "[", "tvars", "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Check", ":", " ", 
    RowBox[{"Should", " ", "Print", " ", "Zero"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"n", "-", "nx", "-", "ny"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.5765000246866026`*^9, 3.5765001227917614`*^9}, {
   3.5768514957931385`*^9, 3.576851496203139*^9}, {3.5771223086224604`*^9, 
   3.5771223295924892`*^9}, {3.5771224365226393`*^9, 3.5771224444326506`*^9}, 
   3.5771225507327995`*^9, 3.593438172860241*^9, 3.609601880430749*^9, {
   3.6096021622458677`*^9, 3.6096021633329296`*^9}, 3.6096794740684047`*^9, 
   3.6339593485029945`*^9},ExpressionUUID->"b72064a2-57d1-4a8b-89c8-\
29630cd63c46"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Regimes", "Subsection",
 CellChangeTimes->{{3.5496299986305246`*^9, 3.549629999468572*^9}, 
   3.5765000569766483`*^9, {3.6040814085299244`*^9, 
   3.6040814097769957`*^9}},ExpressionUUID->"f8a95bf5-61f9-47d8-8d7e-\
11c8f94157e6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Pmat", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"P", "[", 
      RowBox[{"ii", ",", "jj"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "1", ",", "ns"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"jj", ",", "1", ",", "ns"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"probrule", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"Flatten", "[", "Pmat", "]"}], ")"}], "\[Rule]", " ", 
     RowBox[{"{", 
      RowBox[{"p11", ",", 
       RowBox[{"1", "-", "p11"}], ",", 
       RowBox[{"1", "-", "p22"}], ",", "p22"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"omegas", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"\[Omega]", "[", "ii", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ii", ",", "1", ",", "ns"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"omegarule", "=", 
   RowBox[{
    RowBox[{"Thread", "[", 
     RowBox[{"omegas", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", 
         RowBox[{"1", "+", 
          RowBox[{"Exp", "[", 
           RowBox[{"-", "\[Eta]1"}], "]"}]}]], ",", 
        FractionBox["1", 
         RowBox[{"1", "+", 
          RowBox[{"Exp", "[", 
           RowBox[{"-", "\[Eta]2"}], "]"}]}]]}], "}"}]}], "]"}], "/.", 
    "funrulei"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Pmat", "=", 
   RowBox[{"Pmat", "/.", "probrule"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"omegas", "=", 
   RowBox[{"omegas", "/.", "omegarule"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.549630010509204*^9, 3.5496300980422106`*^9}, {
   3.5496302840118475`*^9, 3.549630286545992*^9}, {3.5496313149698143`*^9, 
   3.5496313164088964`*^9}, {3.549631569783389*^9, 3.54963157207952*^9}, {
   3.5496429523946824`*^9, 3.549643002473547*^9}, {3.549646264415119*^9, 
   3.549646335724198*^9}, 3.549646849827603*^9, {3.5497134558872995`*^9, 
   3.54971345606631*^9}, {3.5497137131240125`*^9, 3.549713714351083*^9}, {
   3.549713757885573*^9, 3.5497138258924627`*^9}, {3.5497139251901417`*^9, 
   3.549713926173198*^9}, {3.549714123920509*^9, 3.5497141259316235`*^9}, {
   3.560033131401148*^9, 3.5600331348043427`*^9}, {3.5600333073432117`*^9, 
   3.560033310620399*^9}, 3.5765000569766483`*^9, {3.576500129841771*^9, 
   3.5765001913218575`*^9}, {3.5772726286460094`*^9, 
   3.5772726361160192`*^9}, {3.5934424472293*^9, 3.593442461724129*^9}, 
   3.6096019553830357`*^9, {3.6096042959431562`*^9, 3.6096043322552333`*^9}, 
   3.6096043705514235`*^9, {3.6096044016452017`*^9, 3.609604405539425*^9}, {
   3.626550520381965*^9, 3.626550520391965*^9}, {3.6265510136711874`*^9, 
   3.626551013681187*^9}, {3.6272359473638573`*^9, 3.6272359549738717`*^9}, {
   3.6272360328130713`*^9, 3.6272360392390842`*^9}, {3.633959385756074*^9, 
   3.633959428885186*^9}, {3.634045841771619*^9, 3.6340458475069466`*^9}, {
   3.6340466526053267`*^9, 3.634046657045333*^9}, {3.634046791653522*^9, 
   3.6340469410487356`*^9}, {3.6340471191719875`*^9, 
   3.6340471244319954`*^9}, {3.634066236025358*^9, 3.6340662709484663`*^9}, {
   3.6340663166555567`*^9, 3.634066318772561*^9}, 3.642975854778837*^9, {
   3.700500013511135*^9, 
   3.7005000166953173`*^9}},ExpressionUUID->"8584b667-73be-4b41-9806-\
78d634ab4c50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"F", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ss", "=", "1"}], ",", 
    RowBox[{"ss", "\[LessEqual]", "ns"}], ",", 
    RowBox[{"ss", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"F", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{"F", ",", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"omegas", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"Pmat", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "*", "f"}], "/.", 
                "probrule"}], "/.", "funrulej"}], "/.", "funrulei"}], "/.", 
             RowBox[{"s", "\[Rule]", "ss"}]}], "/.", 
            RowBox[{"sp", "\[Rule]", "j"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "ns"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ns"}], "}"}]}], "]"}]}], "}"}], 
       "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.608414307009746*^9, 3.608414422526353*^9}, {
   3.608414507812231*^9, 3.608414507941239*^9}, {3.608414600592538*^9, 
   3.6084146025746517`*^9}, {3.609601962639451*^9, 3.6096019674867277`*^9}, {
   3.6097758642534857`*^9, 3.6097759138283205`*^9}, 3.6097760476919775`*^9, {
   3.6098539300319843`*^9, 3.6098539309420366`*^9}, {3.6272276167742467`*^9, 
   3.627227735876416*^9}, {3.6272323795087004`*^9, 3.6272323816587048`*^9}, {
   3.6272324510938964`*^9, 3.627232451713897*^9}, {3.633959355430009*^9, 
   3.6339593828260665`*^9}, {3.633959438415208*^9, 3.633959443891219*^9}, {
   3.634045861459745*^9, 3.6340458617637625`*^9}, {3.6340460590492735`*^9, 
   3.6340461473394823`*^9}, {3.634046669877351*^9, 3.634046701380395*^9}, {
   3.6340469210387077`*^9, 3.634046928788718*^9}, {3.63404697991579*^9, 
   3.6340470861459413`*^9}, {3.634047273285206*^9, 3.6340472752852087`*^9}, {
   3.63404789271208*^9, 3.634047903242095*^9}, {3.63404801345925*^9, 
   3.634048029052273*^9}, {3.6340538341830096`*^9, 3.6340538356990137`*^9}, {
   3.634053977507408*^9, 3.6340539812374163`*^9}, {3.634066022999796*^9, 
   3.6340660249198003`*^9}, {3.634066953796282*^9, 3.6340669776483154`*^9}, {
   3.6340673083627825`*^9, 3.6340673090827837`*^9}, {3.634316853712671*^9, 
   3.6343168549127393`*^9}, 3.6343265051331263`*^9, {3.6404566753720303`*^9, 
   3.640456678702035*^9}},ExpressionUUID->"7785163c-bb84-47fd-9189-\
f0b93740cd13"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Steady State", "Section",
 CellChangeTimes->{{3.6339594897533135`*^9, 
  3.6339594911303167`*^9}},ExpressionUUID->"ec0cdd67-c6fd-416e-83b8-\
38214d119daf"],

Cell[CellGroupData[{

Cell["Analytic Steady State", "Subsection",
 CellChangeTimes->{{3.6339595327294025`*^9, 
  3.6339595363294096`*^9}},ExpressionUUID->"d26f06b3-8abb-402f-aeef-\
a5640d824e5f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"zssval", "=", "\[Mu]bar"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kssval", "=", 
   RowBox[{"Log", "[", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"\[Alpha]", "*", 
         RowBox[{"Exp", "[", "\[Mu]bar", "]"}]}]], "*", 
       RowBox[{"(", 
        RowBox[{
         FractionBox["1", 
          RowBox[{"\[Beta]", "*", 
           SuperscriptBox[
            RowBox[{"Exp", "[", "\[Mu]bar", "]"}], 
            FractionBox[
             RowBox[{"-", "1"}], 
             RowBox[{"1", "-", "\[Alpha]"}]]]}]], "-", "1", "+", "\[Delta]"}],
         ")"}]}], ")"}], 
     FractionBox["1", 
      RowBox[{"\[Alpha]", "-", "1"}]]], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cssval", "=", 
   RowBox[{"Log", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Exp", "[", "\[Mu]bar", "]"}], "*", 
      SuperscriptBox[
       RowBox[{"Exp", "[", "kssval", "]"}], "\[Alpha]"]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "\[Delta]", "-", 
        SuperscriptBox[
         RowBox[{"Exp", "[", "\[Mu]bar", "]"}], 
         FractionBox["1", 
          RowBox[{"1", "-", "\[Alpha]"}]]]}], ")"}], "*", 
      RowBox[{"Exp", "[", "kssval", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Eta]1ssval", "=", 
   RowBox[{"Log", "[", 
    FractionBox[
     RowBox[{"1", "-", "p22"}], 
     RowBox[{"1", "-", "p11"}]], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Eta]2ssval", "=", 
   RowBox[{"Log", "[", 
    FractionBox[
     RowBox[{"1", "-", "p11"}], 
     RowBox[{"1", "-", "p22"}]], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.633959541539445*^9, 3.633959565429519*^9}, {
   3.634047466281478*^9, 3.6340474954635196`*^9}, {3.634306434288869*^9, 
   3.6343064354889374`*^9}, {3.6404556864643564`*^9, 3.6404557048134327`*^9}, 
   3.642975810657775*^9, {3.6459023062495337`*^9, 3.645902306522534*^9}, {
   3.6712955274005876`*^9, 3.671295542231639*^9}, {3.700499538630974*^9, 
   3.7004995539188485`*^9}, {3.700500092183635*^9, 3.700500107542514*^9}, {
   3.718711671071354*^9, 3.7187116794895163`*^9}, {3.718711736576641*^9, 
   3.7187118103973618`*^9}, {3.7240081860692573`*^9, 
   3.7240081910928397`*^9}, {3.7240197243212943`*^9, 
   3.7240197245091553`*^9}},ExpressionUUID->"6e81ed6b-62bc-41ed-9e1d-\
bd89e5be6faf"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Parameters", "Subsection",
 CellChangeTimes->{{3.6339596564007053`*^9, 
  3.633959657717708*^9}},ExpressionUUID->"594a9c72-08e5-4436-b8cf-\
3e978628500a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"parmrule", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]", "\[Rule]", "0.99722"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\[Alpha]", "\[Rule]", "0.28"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\[Delta]", "\[Rule]", "0.025"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\[Mu]bar", "\[Rule]", 
      FractionBox["1.3277", "400"]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\[Sigma]bar", "\[Rule]", 
      FractionBox["3.1448", "400"]}], ",", "\[IndentingNewLine]", 
     RowBox[{"p11", "\[Rule]", "0.98"}], ",", "\[IndentingNewLine]", 
     RowBox[{"p22", "\[Rule]", "0.98"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Mu]", "[", "1", "]"}], "\[Rule]", 
      FractionBox["0.712011", "400"]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Mu]", "[", "2", "]"}], "\[Rule]", 
      FractionBox["1.94348", "400"]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Sigma]", "[", "1", "]"}], "\[Rule]", 
      FractionBox["2.52795", "400"]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Sigma]", "[", "2", "]"}], "\[Rule]", " ", 
      FractionBox["3.76156", "400"]}], ",", "\[IndentingNewLine]", 
     RowBox[{"filename", "\[Rule]", "\"\<rbc_example_approach1\>\""}]}], 
    "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7187078051290083`*^9, 3.718707846594575*^9}, {
   3.7187081441472883`*^9, 3.7187081585609922`*^9}, {3.723669872104511*^9, 
   3.7236698949031897`*^9}, {3.7240058986292095`*^9, 
   3.7240059148994007`*^9}, {3.7240081968123074`*^9, 3.724008208263276*^9}, 
   3.7240085342187366`*^9, 3.7240088055684686`*^9, 3.7240169907789974`*^9, {
   3.724019728525217*^9, 3.724019729942027*^9}, 3.724769505753533*^9, 
   3.7247695659133725`*^9, {3.7367673918444786`*^9, 3.7367673921368604`*^9}, {
   3.736767532110626*^9, 3.736767605674574*^9}, {3.738722027939418*^9, 
   3.7387220396269836`*^9}, {3.7387223677387023`*^9, 3.738722375161716*^9}, 
   3.7390257932054234`*^9},ExpressionUUID->"349195aa-70c0-4075-a106-\
b3ebf9d51cc3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Rules", "Subsection",
 CellChangeTimes->{{3.6339595387094145`*^9, 
  3.6339595391994147`*^9}},ExpressionUUID->"20c69569-1cbb-410f-b0ba-\
a9f2ccbd9b11"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"derivrule", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"d", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"Derivative", "[", "__", "]"}], "[", "_", "]"}], "[", "__", 
       "]"}]}], "\[RuleDelayed]", "\[VeryThinSpace]", 
     RowBox[{"d", "[", 
      RowBox[{"[", "0", "]"}], "]"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ssrule", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Chi]", "\[Rule]", "0"}], ",", 
      RowBox[{"Thread", "[", 
       RowBox[{"xlag", "\[Rule]", "xvarss"}], "]"}], ",", 
      RowBox[{"Thread", "[", 
       RowBox[{"xfunlist", "\[Rule]", "xvarss"}], "]"}], ",", 
      RowBox[{"Thread", "[", 
       RowBox[{"yfunlist", "\[Rule]", "yvarss"}], "]"}]}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsrule", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{"eps", "\[Rule]", "0"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsprule1", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{"epsp", "\[Rule]", "0"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsprule2", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     SuperscriptBox["epsp", "2"], "\[Rule]", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ssvalrule", "=", 
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"xvarss", ",", "yvarss"}], "}"}], "]"}], "\[Rule]", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"xvarssval", ",", "yvarssval"}], "}"}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.63395949264032*^9, 3.6339595222303805`*^9}, 
   3.6339596303316517`*^9, {3.6339596996938286`*^9, 3.6339597085868464`*^9}, {
   3.6340474061373925`*^9, 3.6340474155074053`*^9}, {3.6340474583614664`*^9, 
   3.6340474634714737`*^9}, {3.6340660930069575`*^9, 
   3.6340660971469655`*^9}, {3.7387224165689173`*^9, 
   3.7387224169282885`*^9}},ExpressionUUID->"9a804a86-e29b-492f-a18b-\
e74fa5a1af49"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Steady State Values", "Subsection",
 CellChangeTimes->{{3.6339595796525483`*^9, 
  3.6339595833025556`*^9}},ExpressionUUID->"d7eda42f-2521-4302-82e6-\
6237c0c063a0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"F", "/.", "ssrule"}], "/.", "ssvalrule"}], "/.", "parmrule"}],
      "/.", "epsrule"}], "/.", "epsprule1"}], "//", "Simplify"}], "//", 
  "Chop"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xvarss", "=", 
   RowBox[{
    RowBox[{"xvarss", "/.", "ssvalrule"}], "/.", "parmrule"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yvarss", "=", 
   RowBox[{
    RowBox[{"yvarss", "/.", "ssvalrule"}], "/.", "parmrule"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.633959572295533*^9, 3.633959633157658*^9}, {
  3.6339597113568525`*^9, 3.633959726192885*^9}, {3.6339597688959785`*^9, 
  3.6339598101950927`*^9}, {3.6340471960260973`*^9, 3.634047200646104*^9}, {
  3.6340473458343077`*^9, 3.6340473478743105`*^9}, {3.6712950567725277`*^9, 
  3.671295065073557*^9}},ExpressionUUID->"79664a30-b791-46f8-86b1-\
d0b84ef3b827"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Check", "Subsection",
 CellChangeTimes->{{3.6712894919236946`*^9, 3.671289493238699*^9}, {
  3.671290479215686*^9, 
  3.671290480971692*^9}},ExpressionUUID->"8fc15b9c-6d0a-4413-bee3-\
181fcbc1c243"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"normcheck", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"normcheck", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "=", 
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"F", "/.", "ssrule"}], "/.", "ssvalrule"}], "/.", "parmrule"}],
      "/.", "epsrule"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.671289495140706*^9, 
  3.6712895262258925`*^9}},ExpressionUUID->"a1f95334-8f45-4529-b944-\
6bb01dc42cb0"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["First Order Approximation", "Section",
 CellChangeTimes->{{3.6339598205711174`*^9, 
  3.633959825021128*^9}},ExpressionUUID->"e586ba42-a5d9-44dd-b14f-\
581a6c735de1"],

Cell[CellGroupData[{

Cell["Matrices", "Subsection",
 CellChangeTimes->{{3.6339601061357975`*^9, 
  3.6339601075257998`*^9}},ExpressionUUID->"059625ea-d392-415a-b211-\
0fd52d6979f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", "ns"}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"G", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"yvars", "/.", "funrulei"}], ",", 
          RowBox[{"{", "state", "}"}]}], "]"}], "/.", "derivrule"}], "/.", 
       RowBox[{"s", "\[Rule]", "ii"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"xvars", "/.", "funrulei"}], ",", 
          RowBox[{"{", "state", "}"}]}], "]"}], "/.", "derivrule"}], "/.", 
       RowBox[{"s", "\[Rule]", "ii"}]}]}]}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.633960110095804*^9, 3.6339601638149366`*^9}, {
   3.634304627903549*^9, 3.634304629174622*^9}, 3.6343046833577213`*^9, {
   3.6343170149368925`*^9, 3.634317015391918*^9}, 
   3.634326327837685*^9},ExpressionUUID->"b6b3cd3f-2f22-4ad1-836b-\
1de866b6cf5b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derivative for x", "Subsection",
 CellChangeTimes->{{3.6339598291911397`*^9, 
  3.6339598311171436`*^9}},ExpressionUUID->"9a1f53d0-e01d-4320-b488-\
bdd4eaba7ea8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dFx", "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"F", ",", 
            RowBox[{"{", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "xlag", "}"}], "]"}], "}"}]}], "]"}], "/.", 
          "derivrule"}], "/.", "ssrule"}], "/.", "ssvalrule"}], "/.", 
       "epsrule"}], "/.", "epsprule1"}], "/.", "parmrule"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"soln", "=", 
   RowBox[{"Solve", "[", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"Flatten", "[", "dFx", "]"}], ")"}], "\[Equal]", "0"}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"soln", "//", "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.6339598343581514`*^9, 3.6339599110193577`*^9}, {
  3.6340540293715153`*^9, 3.6340541167367563`*^9}, {3.634054426207021*^9, 
  3.634054434687033*^9}, {3.6340544799061003`*^9, 3.6340545091501417`*^9}, {
  3.634054620911306*^9, 3.6340546477323456`*^9}, {3.634055884716631*^9, 
  3.634055909388666*^9}, {3.6340665376111116`*^9, 3.634066539938117*^9}, {
  3.6340670467144136`*^9, 3.634067048904417*^9}, {3.634306452417906*^9, 
  3.6343064745131693`*^9}, {3.6343066137597055`*^9, 3.6343066393567414`*^9}, {
  3.6343066726667995`*^9, 3.6343067842359624`*^9}, {3.634308924097271*^9, 
  3.634308935648932*^9}, {3.634309113327636*^9, 3.634309114662712*^9}, {
  3.6343092123102975`*^9, 3.634309212797325*^9}, {3.6343092683622956`*^9, 
  3.6343093136283593`*^9}, {3.6343168784800873`*^9, 3.634316921247534*^9}, {
  3.634324982583508*^9, 3.634324993893531*^9}, {3.6404572465206575`*^9, 
  3.640457249826666*^9}},ExpressionUUID->"7ada2215-2821-469f-8e9d-\
fdaa79109b76"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Check for MSS", "Subsection",
 CellChangeTimes->{{3.640024608975321*^9, 
  3.6400246113553267`*^9}},ExpressionUUID->"d29d9df2-5fe8-4dc9-86bd-\
e06df36304b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"count", "=", "0"}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"Number", " ", "of", " ", "MSS", " ", "Solutions"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Check", " ", "MSS", " ", "of", " ", "each", " ", "soln"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"solution", "=", 
    RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Construct", " ", "T", " ", "matrix"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[CapitalUpsilon]", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SuperscriptBox["nx", "2"], "*", "ns"}], ",", 
       RowBox[{
        SuperscriptBox["nx", "2"], "*", "ns"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", "ns"}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[CapitalUpsilon]", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ii", "-", "1"}], ")"}], "*", 
           SuperscriptBox["nx", "2"]}], "+", "1"}], ";;", 
         RowBox[{"ii", "*", 
          SuperscriptBox["nx", "2"]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ii", "-", "1"}], ")"}], "*", 
           SuperscriptBox["nx", "2"]}], "+", "1"}], ";;", 
         RowBox[{"ii", "*", 
          SuperscriptBox["nx", "2"]}]}]}], "]"}], "]"}], "=", 
     RowBox[{"KroneckerProduct", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"H", "[", "ii", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"1", ";;", "nx"}], ",", 
          RowBox[{"1", ";;", "nx"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"H", "[", "ii", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"1", ";;", "nx"}], ",", 
          RowBox[{"1", ";;", "nx"}]}], "]"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tmat", "=", 
    RowBox[{
     RowBox[{"KroneckerProduct", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", "Pmat", "]"}], ",", 
       RowBox[{"IdentityMatrix", "[", 
        SuperscriptBox["nx", "2"], "]"}]}], "]"}], ".", 
     "\[CapitalUpsilon]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Check", " ", "Eigenvalues", " ", "of", " ", "T"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", 
     RowBox[{
      RowBox[{"Dimensions", "[", "soln", "]"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"Max", "[", 
       RowBox[{"Abs", "[", 
        RowBox[{"Eigenvalues", "[", 
         RowBox[{
          RowBox[{"Tmat", "/.", "parmrule"}], "/.", 
          RowBox[{"soln", "[", 
           RowBox[{"[", "ii", "]"}], "]"}]}], "]"}], "]"}], "]"}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", 
          RowBox[{"Eigenvalues", "[", 
           RowBox[{
            RowBox[{"Tmat", "/.", "parmrule"}], "/.", 
            RowBox[{"soln", "[", 
             RowBox[{"[", "ii", "]"}], "]"}]}], "]"}], "]"}], "]"}], "<", 
        "1"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"If", " ", "MSS"}], ",", " ", 
         RowBox[{
         "increment", " ", "count", " ", "and", " ", "save", " ", "as", " ", 
          "solution"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"count", "++"}], ";", "\[IndentingNewLine]", 
        RowBox[{"solution", "=", 
         RowBox[{"soln", "[", 
          RowBox[{"[", "ii", "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"count", "//", "Print"}], "\[IndentingNewLine]", 
 RowBox[{"solution", "//", "Print"}]}], "Input",
 CellChangeTimes->{{3.640024614325334*^9, 
  3.6400246768855286`*^9}},ExpressionUUID->"ae7483fb-f57e-4a2f-b77c-\
610d3d52acf4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derivative for \[Epsilon]", "Subsection",
 CellChangeTimes->{{3.6339599150693665`*^9, 3.6339599207093773`*^9}, {
   3.643043350557083*^9, 3.643043352147085*^9}, 
   3.6455436420590296`*^9},ExpressionUUID->"79feda57-88ed-4e4d-91f3-\
ef3719032672"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dF\[Epsilon]", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{"F", ",", 
           RowBox[{"{", "eps", "}"}]}], "]"}], "/.", "derivrule"}], "/.", 
        "ssrule"}], "/.", "ssvalrule"}], "/.", "parmrule"}], "/.", 
     "solution"}], "/.", "epsrule"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solution", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"solution", ",", 
      RowBox[{"Solve", "[", 
       RowBox[{"Thread", "[", 
        RowBox[{"dF\[Epsilon]", "\[Equal]", "0"}], "]"}], "]"}]}], "}"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.633959928411392*^9, 3.6339599808755093`*^9}, {
  3.634055947280719*^9, 3.6340559597207365`*^9}, {3.6340670644144387`*^9, 
  3.6340670913264766`*^9}, {3.640457917984355*^9, 
  3.640457933166396*^9}},ExpressionUUID->"b1609598-662a-4ddb-8b9c-\
f8c4f4295597"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derivative for \[Chi]", "Subsection",
 CellChangeTimes->{{3.6339599150693665`*^9, 3.6339599207093773`*^9}, {
  3.6339599873015223`*^9, 
  3.6339599895315266`*^9}},ExpressionUUID->"36c7b637-1efe-472b-995e-\
23ef54f859f1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dF\[Chi]", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"F", ",", 
            RowBox[{"{", "\[Chi]", "}"}]}], "]"}], "/.", "derivrule"}], "/.", 
         "ssrule"}], "/.", "ssvalrule"}], "/.", "parmrule"}], "/.", 
      "epsrule"}], "/.", "epsprule1"}], "/.", "solution"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solution", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"solution", ",", 
      RowBox[{"Solve", "[", 
       RowBox[{"Thread", "[", 
        RowBox[{"dF\[Chi]", "\[Equal]", "0"}], "]"}], "]"}]}], "}"}], "]"}]}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.633959928411392*^9, 3.633959997538543*^9}, {
  3.63396005281668*^9, 3.633960056626687*^9}, {3.6340559842577734`*^9, 
  3.6340560045578017`*^9}, {3.634067104646495*^9, 3.6340671062464976`*^9}, {
  3.640457920831361*^9, 
  3.640457944028427*^9}},ExpressionUUID->"24e9c605-7d9b-4624-b308-\
da9380a06deb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Check Accuracy", "Subsection",
 CellChangeTimes->{{3.671289338092142*^9, 
  3.671289340019149*^9}},ExpressionUUID->"31b55772-f7d5-4c6c-a3d5-\
29b39ff74153"],

Cell[BoxData[
 RowBox[{
  RowBox[{"normcheck", "[", 
   RowBox[{"[", "2", "]"}], "]"}], "=", 
  RowBox[{"Norm", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"F", ",", 
            RowBox[{"{", "state", "}"}]}], "]"}], "/.", "derivrule"}], "/.", 
         "ssrule"}], "/.", "ssvalrule"}], "/.", "parmrule"}], "/.", 
      "solution"}], "/.", "epsprule1"}], "/.", "epsrule"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6712893409271526`*^9, 3.6712893819092865`*^9}, {
  3.6712895640110188`*^9, 3.6712895942061605`*^9}, {3.6712896436073203`*^9, 
  3.671289676141431*^9}, {3.718381341523344*^9, 
  3.7183813492762156`*^9}},ExpressionUUID->"e5208111-307a-4fe5-b5a0-\
a0806de1133e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Matrices", "Subsection",
 CellChangeTimes->{{3.6339601061357975`*^9, 
  3.6339601075257998`*^9}},ExpressionUUID->"b3305e96-1a22-4730-932b-\
39ec5e08ee53"],

Cell[BoxData[
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", "ns"}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"G", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{"G", "[", "ii", "]"}], "/.", "solution"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{"H", "[", "ii", "]"}], "/.", "solution"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Chop", "[", 
       RowBox[{"MatrixForm", "[", 
        RowBox[{"G", "[", "ii", "]"}], "]"}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Chop", "[", 
       RowBox[{"MatrixForm", "[", 
        RowBox[{"H", "[", "ii", "]"}], "]"}], "]"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.633960110095804*^9, 3.6339601638149366`*^9}, {
   3.63406714385855*^9, 3.6340671745925937`*^9}, {3.634309249097268*^9, 
   3.6343092546372757`*^9}, {3.640457921570363*^9, 3.6404579224313655`*^9}, 
   3.645543681249087*^9, {3.700499584032571*^9, 
   3.700499592871076*^9}},ExpressionUUID->"614c2698-8ac4-4f78-bc53-\
6c95f103e697"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Second Order Perturbation", "Section",
 CellChangeTimes->{{3.5497122872214556`*^9, 
  3.5497122923997517`*^9}},ExpressionUUID->"fa64f8a0-9d2a-4a64-95a6-\
2f7c98ab3da9"],

Cell[CellGroupData[{

Cell["Taking Derivatives", "Subsection",
 CellChangeTimes->{{3.5360061098685827`*^9, 3.5360061175960245`*^9}, {
  3.549712322283461*^9, 
  3.549712324832607*^9}},ExpressionUUID->"6740d071-6f34-4be0-977d-\
5d7e3d08cdd9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d2Fss", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", 
     RowBox[{"nx", "+", "ne", "+", "1"}]}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"jj", "=", "ii"}], ",", 
       RowBox[{"jj", "\[LessEqual]", 
        RowBox[{"nx", "+", "ne", "+", "1"}]}], ",", 
       RowBox[{"jj", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"d2Fss", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"d2Fss", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"D", "[", 
                   RowBox[{"F", ",", 
                    RowBox[{"{", 
                    RowBox[{"state", "[", 
                    RowBox[{"[", "ii", "]"}], "]"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"state", "[", 
                    RowBox[{"[", "jj", "]"}], "]"}], "}"}]}], "]"}], "/.", 
                  "derivrule"}], "/.", "ssrule"}], "/.", "ssvalrule"}], "/.", 
               "epsrule"}], "/.", "parmrule"}], "/.", "solution"}]}], "}"}], 
          "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.537299978328273*^9, 3.537299997175351*^9}, {
   3.537300083073264*^9, 3.5373000862864475`*^9}, {3.537300163827883*^9, 
   3.5373001732244205`*^9}, {3.5373003107722874`*^9, 
   3.5373003168296337`*^9}, {3.5373003935210204`*^9, 
   3.5373004184064436`*^9}, {3.537300452350385*^9, 3.5373004560755987`*^9}, {
   3.53730057114118*^9, 3.537300634153784*^9}, {3.537301478644086*^9, 
   3.537301485445475*^9}, {3.5434220185638*^9, 3.5434220187398*^9}, {
   3.5435781071776013`*^9, 3.543578107377613*^9}, {3.544187785762565*^9, 
   3.5441877859455757`*^9}, {3.5441887901490126`*^9, 
   3.5441887903490243`*^9}, {3.5442791108333244`*^9, 
   3.5442791141095114`*^9}, {3.549712615232217*^9, 3.549712615678242*^9}, {
   3.6156481997036157`*^9, 3.6156481998796253`*^9}, {3.6401057397408013`*^9, 
   3.640105740040802*^9}, {3.6404521792490096`*^9, 3.6404521911990385`*^9}, {
   3.640544796590741*^9, 3.6405447968207417`*^9}, 3.641049403027667*^9, {
   3.6410494444920387`*^9, 3.6410494457391095`*^9}, {3.641049483227254*^9, 
   3.641049483595275*^9}, {3.641049529506901*^9, 3.6410495298909225`*^9}, {
   3.643043852932678*^9, 3.643043854090684*^9}, {3.6430439983602304`*^9, 
   3.643044001917242*^9}},ExpressionUUID->"b4dd8289-e647-476a-b732-\
f587d612d231"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Expectations of Future Shocks", "Subsection",
 CellChangeTimes->{{3.5497123305569344`*^9, 
  3.5497123432656612`*^9}},ExpressionUUID->"7dd26c5e-a383-4492-bf7c-\
327fcef69edd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"E0", ",", "E1", ",", "E2"}], "}"}], "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"d2Fss", ",", "epsp"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d2Fss", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Normal", "[", "E0", "]"}], "+", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "E2", "]"}], ".", "epsp", ".", "epsp"}], 
        "]"}]}], "/.", "epsprule2"}], "/.", "epsprule1"}], "/.", 
    "epsrule"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5369487634414787`*^9, 3.5369488100481443`*^9}, {
   3.5369488943369656`*^9, 3.5369489014713736`*^9}, {3.536949133624652*^9, 
   3.536949140994074*^9}, {3.536951585376768*^9, 3.536951592646381*^9}, 
   3.537301741329111*^9, {3.5373019012662587`*^9, 3.5373019028413486`*^9}, 
   3.543244502227271*^9, 3.5432447490863905`*^9, {3.543245043350221*^9, 
   3.543245044749301*^9}, {3.5432453262013993`*^9, 3.5432453314847016`*^9}, 
   3.5432456069484572`*^9, {3.543245724396175*^9, 3.543245729471465*^9}, 
   3.543246052774957*^9, {3.5434220218898*^9, 3.5434220220338*^9}, {
   3.5435781082076607`*^9, 3.5435781083996716`*^9}, {3.54418778846472*^9, 
   3.5441877886487303`*^9}, {3.544188792842167*^9, 3.5441887930241776`*^9}, {
   3.5442791146195407`*^9, 3.5442791160976257`*^9}, 3.549712493047228*^9, {
   3.6430438100985355`*^9, 3.643043812008541*^9}, {3.6430440418653727`*^9, 
   3.6430440422543755`*^9}},ExpressionUUID->"66b1cb87-1e28-4282-932b-\
9009671bd596"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solving Linear System", "Subsection",
 CellChangeTimes->{{3.549712347193886*^9, 
  3.5497123502800627`*^9}},ExpressionUUID->"e865e68e-7cfd-44a9-891d-\
4393562f6375"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Variables", "[", "d2Fss", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"NN", ",", "MM"}], "}"}], "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"d2Fss", ",", "vars"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solution", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"solution", ",", 
      RowBox[{"Thread", "[", 
       RowBox[{"vars", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"-", 
          RowBox[{
           RowBox[{"Inverse", "[", "MM", "]"}], ".", "NN"}]}], ")"}]}], 
       "]"}]}], "}"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5369283351621113`*^9, 3.5369283655028467`*^9}, {
  3.53692840122289*^9, 3.536928477952279*^9}, {3.536928545021115*^9, 
  3.5369285908757377`*^9}, {3.5369289031856008`*^9, 3.536928948024165*^9}, {
  3.5434220240978003`*^9, 3.5434220242578*^9}, {3.5435781090947113`*^9, 
  3.543578109334725*^9}, {3.5441877912068768`*^9, 3.544187791366886*^9}, {
  3.544188795895342*^9, 3.5441887960943527`*^9}, {3.5442791171206837`*^9, 
  3.5442791192468057`*^9}},ExpressionUUID->"7bc49d9c-099a-45b7-875f-\
53ec28cf8eba"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Check Accuracy", "Subsection",
 CellChangeTimes->{{3.6712896946964912`*^9, 
  3.6712897012435565`*^9}},ExpressionUUID->"c51548be-7ba5-42d3-9866-\
6d7c28136ffb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"normcheck", "[", 
   RowBox[{"[", "3", "]"}], "]"}], "=", 
  RowBox[{"Norm", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Expand", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"D", "[", 
              RowBox[{"F", ",", 
               RowBox[{"{", 
                RowBox[{"state", ",", "2"}], "}"}]}], "]"}], "/.", 
             "derivrule"}], "/.", "ssrule"}], "/.", "ssvalrule"}], "/.", 
          "parmrule"}], "/.", "solution"}], "/.", "epsrule"}], "]"}], "]"}], "/.",
      "epsprule2"}], "/.", "epsprule1"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6712897026725626`*^9, 3.6712897896489286`*^9}, {
   3.6712899073233624`*^9, 3.6712899138883877`*^9}, {3.671289948607499*^9, 
   3.6712899509955063`*^9}, 3.671289991208688*^9, {3.671290053576893*^9, 
   3.6712900589029107`*^9}, {3.7180417767272663`*^9, 
   3.7180417880953536`*^9}, {3.718381584729933*^9, 3.718381590568714*^9}, 
   3.718711520985218*^9},ExpressionUUID->"925cac81-b050-4e9a-9f90-\
a6fa1cdeae8a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Saving Solution", "Subsection",
 CellChangeTimes->{{3.5360044033569756`*^9, 
  3.5360044090172997`*^9}},ExpressionUUID->"7afcdc40-c210-4830-b9ae-\
e2f278a52296"],

Cell[BoxData[
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", "ns"}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"G2", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"yvars", "/.", "funrulei"}], ",", 
           RowBox[{"{", 
            RowBox[{"state", ",", "2"}], "}"}]}], "]"}], "/.", "derivrule"}], 
        "/.", 
        RowBox[{"s", "\[Rule]", "ii"}]}], "/.", "solution"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"G2", "[", "ii", "]"}], "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"G2", "[", "ii", "]"}], "]"}], ",", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"nx", "+", "ne", "+", "1"}], ")"}], "2"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H2", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"xvars", "/.", "funrulei"}], ",", 
           RowBox[{"{", 
            RowBox[{"state", ",", "2"}], "}"}]}], "]"}], "/.", "derivrule"}], 
        "/.", 
        RowBox[{"s", "\[Rule]", "ii"}]}], "/.", "solution"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H2", "[", "ii", "]"}], "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"H2", "[", "ii", "]"}], "]"}], ",", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"nx", "+", "ne", "+", "1"}], ")"}], "2"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Chop", "[", 
       RowBox[{"MatrixForm", "[", 
        RowBox[{"G2", "[", "ii", "]"}], "]"}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Chop", "[", 
       RowBox[{"MatrixForm", "[", 
        RowBox[{"H2", "[", "ii", "]"}], "]"}], "]"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.536004455513959*^9, 3.536004467257631*^9}, {
   3.536004644196751*^9, 3.536004644668778*^9}, {3.536004787317937*^9, 
   3.536004857026924*^9}, {3.5360053244116573`*^9, 3.536005324971689*^9}, {
   3.536005462369548*^9, 3.536005577646141*^9}, 3.536005611583082*^9, {
   3.5360056512653522`*^9, 3.536005652295411*^9}, {3.536005708824644*^9, 
   3.536005738658351*^9}, {3.536005827619439*^9, 3.5360058838716564`*^9}, {
   3.536006084104109*^9, 3.536006088804378*^9}, {3.549712742721509*^9, 
   3.549712744719623*^9}, {3.61565529099061*^9, 3.615655292573701*^9}, {
   3.6401057315107813`*^9, 3.6401057347307887`*^9}, {3.643046654887161*^9, 
   3.643046686536207*^9}, {3.6430467430632906`*^9, 3.6430467447942934`*^9}, {
   3.700499607199896*^9, 3.7004996073739057`*^9}, {3.70049967702989*^9, 
   3.70049967739091*^9}},ExpressionUUID->"a9340958-9352-4a56-8b0b-\
c5bae7ed519e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Third Order Perturbation", "Section",
 CellChangeTimes->{{3.5497122872214556`*^9, 3.5497122923997517`*^9}, {
  3.7004996895186043`*^9, 
  3.700499690757675*^9}},ExpressionUUID->"5776a6be-92fd-43ff-869e-\
1671a72218f5"],

Cell[CellGroupData[{

Cell["Taking Derivatives", "Subsection",
 CellChangeTimes->{{3.5360061098685827`*^9, 3.5360061175960245`*^9}, {
  3.549712322283461*^9, 
  3.549712324832607*^9}},ExpressionUUID->"78caa6fa-2cda-4aea-ac4a-\
f252d4763939"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d3Fss", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", 
     RowBox[{"nx", "+", "ne", "+", "1"}]}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"jj", "=", "ii"}], ",", 
       RowBox[{"jj", "\[LessEqual]", 
        RowBox[{"nx", "+", "ne", "+", "1"}]}], ",", 
       RowBox[{"jj", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"kk", "=", "jj"}], ",", 
          RowBox[{"kk", "\[LessEqual]", 
           RowBox[{"nx", "+", "ne", "+", "1"}]}], ",", 
          RowBox[{"kk", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"d3Fss", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"d3Fss", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"D", "[", 
                    RowBox[{"F", ",", 
                    RowBox[{"{", 
                    RowBox[{"state", "[", 
                    RowBox[{"[", "ii", "]"}], "]"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"state", "[", 
                    RowBox[{"[", "jj", "]"}], "]"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"state", "[", 
                    RowBox[{"[", "kk", "]"}], "]"}], "}"}]}], "]"}], "/.", 
                    "derivrule"}], "/.", "ssrule"}], "/.", "ssvalrule"}], "/.",
                   "epsrule"}], "/.", "parmrule"}], "/.", "solution"}]}], 
              "}"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.537299978328273*^9, 3.537299997175351*^9}, {
   3.537300083073264*^9, 3.5373000862864475`*^9}, {3.537300163827883*^9, 
   3.5373001732244205`*^9}, {3.5373003107722874`*^9, 
   3.5373003168296337`*^9}, {3.5373003935210204`*^9, 
   3.5373004184064436`*^9}, {3.537300452350385*^9, 3.5373004560755987`*^9}, {
   3.53730057114118*^9, 3.537300634153784*^9}, {3.537301478644086*^9, 
   3.537301485445475*^9}, {3.5434220185638*^9, 3.5434220187398*^9}, {
   3.5435781071776013`*^9, 3.543578107377613*^9}, {3.544187785762565*^9, 
   3.5441877859455757`*^9}, {3.5441887901490126`*^9, 
   3.5441887903490243`*^9}, {3.5442791108333244`*^9, 
   3.5442791141095114`*^9}, {3.549712615232217*^9, 3.549712615678242*^9}, {
   3.6156481997036157`*^9, 3.6156481998796253`*^9}, {3.6401057397408013`*^9, 
   3.640105740040802*^9}, {3.6404521792490096`*^9, 3.6404521911990385`*^9}, {
   3.640544796590741*^9, 3.6405447968207417`*^9}, 3.641049403027667*^9, {
   3.6410494444920387`*^9, 3.6410494457391095`*^9}, {3.641049483227254*^9, 
   3.641049483595275*^9}, {3.641049529506901*^9, 3.6410495298909225`*^9}, {
   3.643043852932678*^9, 3.643043854090684*^9}, {3.6430439983602304`*^9, 
   3.643044001917242*^9}, {3.694347075449092*^9, 3.6943471116109147`*^9}, {
   3.6943471973405557`*^9, 
   3.694347198151289*^9}},ExpressionUUID->"2ada3d6f-b5ec-47d3-bcad-\
a5716841415c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Expectations of Future Shocks", "Subsection",
 CellChangeTimes->{{3.5497123305569344`*^9, 
  3.5497123432656612`*^9}},ExpressionUUID->"ca530145-cdb9-46e7-8cf5-\
56ae4462b6e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"E0", ",", "E1", ",", "E2", ",", "E3"}], "}"}], "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"d3Fss", ",", "epsp"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d3Fss", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Normal", "[", "E0", "]"}], "+", 
       RowBox[{"Expand", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "E2", "]"}], ".", "epsp", ".", "epsp"}], 
        "]"}]}], "/.", "epsprule2"}], "/.", "epsprule1"}], "/.", 
    "epsrule"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5369487634414787`*^9, 3.5369488100481443`*^9}, {
   3.5369488943369656`*^9, 3.5369489014713736`*^9}, {3.536949133624652*^9, 
   3.536949140994074*^9}, {3.536951585376768*^9, 3.536951592646381*^9}, 
   3.537301741329111*^9, {3.5373019012662587`*^9, 3.5373019028413486`*^9}, 
   3.543244502227271*^9, 3.5432447490863905`*^9, {3.543245043350221*^9, 
   3.543245044749301*^9}, {3.5432453262013993`*^9, 3.5432453314847016`*^9}, 
   3.5432456069484572`*^9, {3.543245724396175*^9, 3.543245729471465*^9}, 
   3.543246052774957*^9, {3.5434220218898*^9, 3.5434220220338*^9}, {
   3.5435781082076607`*^9, 3.5435781083996716`*^9}, {3.54418778846472*^9, 
   3.5441877886487303`*^9}, {3.544188792842167*^9, 3.5441887930241776`*^9}, {
   3.5442791146195407`*^9, 3.5442791160976257`*^9}, 3.549712493047228*^9, {
   3.6430438100985355`*^9, 3.643043812008541*^9}, {3.6430440418653727`*^9, 
   3.6430440422543755`*^9}, {3.700499795838685*^9, 3.7004997999589205`*^9}, {
   3.7004999284392695`*^9, 
   3.7004999294783287`*^9}},ExpressionUUID->"bfa3387b-fbfa-43f9-962b-\
2f421f22293a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solving Linear System", "Subsection",
 CellChangeTimes->{{3.549712347193886*^9, 
  3.5497123502800627`*^9}},ExpressionUUID->"e4c4febd-5477-439b-bcf9-\
b1806edbc66b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Variables", "[", "d3Fss", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"NN", ",", "MM"}], "}"}], "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"d3Fss", ",", "vars"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solution", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"{", 
     RowBox[{"solution", ",", 
      RowBox[{"Thread", "[", 
       RowBox[{"vars", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"-", 
          RowBox[{
           RowBox[{"Inverse", "[", "MM", "]"}], ".", "NN"}]}], ")"}]}], 
       "]"}]}], "}"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5369283351621113`*^9, 3.5369283655028467`*^9}, {
  3.53692840122289*^9, 3.536928477952279*^9}, {3.536928545021115*^9, 
  3.5369285908757377`*^9}, {3.5369289031856008`*^9, 3.536928948024165*^9}, {
  3.5434220240978003`*^9, 3.5434220242578*^9}, {3.5435781090947113`*^9, 
  3.543578109334725*^9}, {3.5441877912068768`*^9, 3.544187791366886*^9}, {
  3.544188795895342*^9, 3.5441887960943527`*^9}, {3.5442791171206837`*^9, 
  3.5442791192468057`*^9}, {3.694347114757768*^9, 
  3.694347116119137*^9}},ExpressionUUID->"4a006a33-cf9f-4147-957e-\
ed5867687b0e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Saving Solution", "Subsection",
 CellChangeTimes->{{3.5360044033569756`*^9, 
  3.5360044090172997`*^9}},ExpressionUUID->"068b4b03-c6b8-457c-910f-\
eda3465deedb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ii", "=", "1"}], ",", 
    RowBox[{"ii", "\[LessEqual]", "ns"}], ",", 
    RowBox[{"ii", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"G3", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"yvars", "/.", "funrulei"}], ",", 
           RowBox[{"{", 
            RowBox[{"state", ",", "3"}], "}"}]}], "]"}], "/.", "derivrule"}], 
        "/.", 
        RowBox[{"s", "\[Rule]", "ii"}]}], "/.", "solution"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"G3", "[", "ii", "]"}], "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"G3", "[", "ii", "]"}], "]"}], ",", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"nx", "+", "ne", "+", "1"}], ")"}], "3"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H3", "[", "ii", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"xvars", "/.", "funrulei"}], ",", 
           RowBox[{"{", 
            RowBox[{"state", ",", "3"}], "}"}]}], "]"}], "/.", "derivrule"}], 
        "/.", 
        RowBox[{"s", "\[Rule]", "ii"}]}], "/.", "solution"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H3", "[", "ii", "]"}], "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"H3", "[", "ii", "]"}], "]"}], ",", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"nx", "+", "ne", "+", "1"}], ")"}], "3"]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Chop", "[", 
       RowBox[{"MatrixForm", "[", 
        RowBox[{"G3", "[", "ii", "]"}], "]"}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Chop", "[", 
       RowBox[{"MatrixForm", "[", 
        RowBox[{"H3", "[", "ii", "]"}], "]"}], "]"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.536004455513959*^9, 3.536004467257631*^9}, {
   3.536004644196751*^9, 3.536004644668778*^9}, {3.536004787317937*^9, 
   3.536004857026924*^9}, {3.5360053244116573`*^9, 3.536005324971689*^9}, {
   3.536005462369548*^9, 3.536005577646141*^9}, 3.536005611583082*^9, {
   3.5360056512653522`*^9, 3.536005652295411*^9}, {3.536005708824644*^9, 
   3.536005738658351*^9}, {3.536005827619439*^9, 3.5360058838716564`*^9}, {
   3.536006084104109*^9, 3.536006088804378*^9}, {3.549712742721509*^9, 
   3.549712744719623*^9}, {3.61565529099061*^9, 3.615655292573701*^9}, {
   3.6401057315107813`*^9, 3.6401057347307887`*^9}, {3.643046654887161*^9, 
   3.643046686536207*^9}, {3.6430467430632906`*^9, 3.6430467447942934`*^9}, {
   3.6940164950434523`*^9, 3.6940164962115192`*^9}, {3.69434711952006*^9, 
   3.6943471385588865`*^9}},ExpressionUUID->"d0185479-7269-48b9-a8c1-\
2e6059811ef5"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1264, 661},
WindowMargins->{{-8, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 216, 4, 53, "Subsection",ExpressionUUID->"1be9c85a-f53d-40f0-aeea-c806872843dc"],
Cell[799, 28, 711, 16, 67, "Input",ExpressionUUID->"e0e16345-cb68-43c8-b05e-6562dabbce46"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1547, 49, 156, 3, 53, "Subsection",ExpressionUUID->"c0eaa71c-8ffd-4a14-884a-388a0cd1440e"],
Cell[1706, 54, 8354, 216, 366, "Input",ExpressionUUID->"90bfea0d-31c9-476c-b354-3c7d9feb47db"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10097, 275, 246, 4, 53, "Subsection",ExpressionUUID->"584da757-11cc-4966-97b3-11b44b90c8e6"],
Cell[10346, 281, 7331, 149, 447, "Input",ExpressionUUID->"2884a3d1-1e63-456b-bb7b-0d7ea48d8704"]
}, Open  ]],
Cell[CellGroupData[{
Cell[17714, 435, 159, 3, 53, "Subsection",ExpressionUUID->"a9d3ee2b-243b-45d1-bf5c-0ecc9423963e"],
Cell[17876, 440, 5917, 139, 390, "Input",ExpressionUUID->"ea689857-324d-4727-a4d2-2326547345e8"],
Cell[23796, 581, 1606, 42, 162, "Input",ExpressionUUID->"b72064a2-57d1-4a8b-89c8-29630cd63c46"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25439, 628, 236, 4, 53, "Subsection",ExpressionUUID->"f8a95bf5-61f9-47d8-8d7e-11c8f94157e6"],
Cell[25678, 634, 3359, 77, 154, "Input",ExpressionUUID->"8584b667-73be-4b41-9806-78d634ab4c50"],
Cell[29040, 713, 2708, 55, 86, "Input",ExpressionUUID->"7785163c-bb84-47fd-9189-f0b93740cd13"]
}, Open  ]],
Cell[CellGroupData[{
Cell[31785, 773, 161, 3, 67, "Section",ExpressionUUID->"ec0cdd67-c6fd-416e-83b8-38214d119daf"],
Cell[CellGroupData[{
Cell[31971, 780, 173, 3, 53, "Subsection",ExpressionUUID->"d26f06b3-8abb-402f-aeef-a5640d824e5f"],
Cell[32147, 785, 2399, 63, 259, "Input",ExpressionUUID->"6e81ed6b-62bc-41ed-9e1d-bd89e5be6faf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[34583, 853, 160, 3, 53, "Subsection",ExpressionUUID->"594a9c72-08e5-4436-b8cf-3e978628500a"],
Cell[34746, 858, 2049, 38, 413, "Input",ExpressionUUID->"349195aa-70c0-4075-a106-b3ebf9d51cc3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[36832, 901, 157, 3, 53, "Subsection",ExpressionUUID->"20c69569-1cbb-410f-b0ba-a9f2ccbd9b11"],
Cell[36992, 906, 2057, 56, 129, "Input",ExpressionUUID->"9a804a86-e29b-492f-a18b-e74fa5a1af49"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39086, 967, 171, 3, 53, "Subsection",ExpressionUUID->"d7eda42f-2521-4302-82e6-6237c0c063a0"],
Cell[39260, 972, 937, 25, 67, "Input",ExpressionUUID->"79664a30-b791-46f8-86b1-d0b84ef3b827"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40234, 1002, 204, 4, 53, "Subsection",ExpressionUUID->"8fc15b9c-6d0a-4413-bee3-181fcbc1c243"],
Cell[40441, 1008, 628, 19, 48, "Input",ExpressionUUID->"a1f95334-8f45-4529-b944-6bb01dc42cb0"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[41118, 1033, 172, 3, 67, "Section",ExpressionUUID->"e586ba42-a5d9-44dd-b14f-581a6c735de1"],
Cell[CellGroupData[{
Cell[41315, 1040, 160, 3, 53, "Subsection",ExpressionUUID->"059625ea-d392-415a-b211-0fd52d6979f5"],
Cell[41478, 1045, 1180, 31, 86, "Input",ExpressionUUID->"b6b3cd3f-2f22-4ad1-836b-1de866b6cf5b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42695, 1081, 168, 3, 53, "Subsection",ExpressionUUID->"9a1f53d0-e01d-4320-b488-bdd4eaba7ea8"],
Cell[42866, 1086, 1813, 40, 67, "Input",ExpressionUUID->"7ada2215-2821-469f-8e9d-fdaa79109b76"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44716, 1131, 163, 3, 53, "Subsection",ExpressionUUID->"d29d9df2-5fe8-4dc9-86bd-e06df36304b6"],
Cell[44882, 1136, 4501, 129, 411, "Input",ExpressionUUID->"ae7483fb-f57e-4a2f-b77c-610d3d52acf4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[49420, 1270, 252, 4, 53, "Subsection",ExpressionUUID->"79feda57-88ed-4e4d-91f3-ef3719032672"],
Cell[49675, 1276, 973, 27, 48, "Input",ExpressionUUID->"b1609598-662a-4ddb-8b9c-f8c4f4295597"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50685, 1308, 226, 4, 53, "Subsection",ExpressionUUID->"36c7b637-1efe-472b-995e-23ef54f859f1"],
Cell[50914, 1314, 1059, 30, 48, "Input",ExpressionUUID->"24e9c605-7d9b-4624-b308-da9380a06deb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52010, 1349, 162, 3, 53, "Subsection",ExpressionUUID->"31b55772-f7d5-4c6c-a3d5-29b39ff74153"],
Cell[52175, 1354, 789, 21, 28, "Input",ExpressionUUID->"e5208111-307a-4fe5-b5a0-a0806de1133e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53001, 1380, 160, 3, 53, "Subsection",ExpressionUUID->"b3305e96-1a22-4730-932b-39ec5e08ee53"],
Cell[53164, 1385, 1293, 33, 124, "Input",ExpressionUUID->"614c2698-8ac4-4f78-bc53-6c95f103e697"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[54506, 1424, 174, 3, 67, "Section",ExpressionUUID->"fa64f8a0-9d2a-4a64-95a6-2f7c98ab3da9"],
Cell[CellGroupData[{
Cell[54705, 1431, 219, 4, 53, "Subsection",ExpressionUUID->"6740d071-6f34-4be0-977d-5d7e3d08cdd9"],
Cell[54927, 1437, 2762, 59, 124, "Input",ExpressionUUID->"b4dd8289-e647-476a-b732-f587d612d231"]
}, Open  ]],
Cell[CellGroupData[{
Cell[57726, 1501, 181, 3, 53, "Subsection",ExpressionUUID->"7dd26c5e-a383-4492-bf7c-327fcef69edd"],
Cell[57910, 1506, 1564, 32, 48, "Input",ExpressionUUID->"66b1cb87-1e28-4282-932b-9009671bd596"]
}, Open  ]],
Cell[CellGroupData[{
Cell[59511, 1543, 171, 3, 53, "Subsection",ExpressionUUID->"e865e68e-7cfd-44a9-891d-4393562f6375"],
Cell[59685, 1548, 1215, 29, 67, "Input",ExpressionUUID->"7bc49d9c-099a-45b7-875f-53ec28cf8eba"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60937, 1582, 166, 3, 53, "Subsection",ExpressionUUID->"c51548be-7ba5-42d3-9866-6d7c28136ffb"],
Cell[61106, 1587, 1126, 28, 28, "Input",ExpressionUUID->"925cac81-b050-4e9a-9f90-a6fa1cdeae8a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62269, 1620, 167, 3, 53, "Subsection",ExpressionUUID->"7afcdc40-c210-4830-b9ae-e2f278a52296"],
Cell[62439, 1625, 3045, 76, 180, "Input",ExpressionUUID->"a9340958-9352-4a56-8b0b-c5bae7ed519e"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[65533, 1707, 224, 4, 67, "Section",ExpressionUUID->"5776a6be-92fd-43ff-869e-1671a72218f5"],
Cell[CellGroupData[{
Cell[65782, 1715, 219, 4, 53, "Subsection",ExpressionUUID->"78caa6fa-2cda-4aea-ac4a-f252d4763939"],
Cell[66004, 1721, 3363, 72, 162, "Input",ExpressionUUID->"2ada3d6f-b5ec-47d3-bcad-a5716841415c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69404, 1798, 181, 3, 53, "Subsection",ExpressionUUID->"ca530145-cdb9-46e7-8cf5-56ae4462b6e1"],
Cell[69588, 1803, 1681, 34, 48, "Input",ExpressionUUID->"bfa3387b-fbfa-43f9-962b-2f421f22293a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[71306, 1842, 171, 3, 53, "Subsection",ExpressionUUID->"e4c4febd-5477-439b-bcf9-b1806edbc66b"],
Cell[71480, 1847, 1264, 30, 67, "Input",ExpressionUUID->"4a006a33-cf9f-4147-957e-ed5867687b0e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[72781, 1882, 167, 3, 53, "Subsection",ExpressionUUID->"068b4b03-c6b8-457c-910f-eda3465deedb"],
Cell[72951, 1887, 3050, 76, 180, "Input",ExpressionUUID->"d0185479-7269-48b9-a8c1-2e6059811ef5"]
}, Open  ]]
}, Open  ]]
}
]
*)

